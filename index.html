  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="utf-8">    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="jquery-3.1.1.min.js"></script>
  </head>
  <body>
    <div id="map_canvas">
    </div>
  </body>

  <script>
  //adresse a changer en fonction de l'url du serveur
  var url = "192.168.1.16:8080"

     function locate(){
      //on passe par la fonction initialize pour récup la position actuelle, si la localisation est bloqué on affiche un message d'erreur
      navigator.geolocation.getCurrentPosition(initialize, fail);
    }

    function initialize(position) {
      //IMAGE BLEU POUR LA GEOLOCALISATION
      var im = 'http://www.robotwoods.com/dev/misc/bluecircle.png';

      var maCarte = new google.maps.Map( document.getElementById("map_canvas"), {zoom: 13});
      var pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      var optionsMarqueur = {
        map: maCarte,
        position: pos,
        icon:im
      };

      var marqueur = new google.maps.Marker( optionsMarqueur );
      maCarte.setCenter(pos);


      // A l'aide d'ajax on appel le web service
    $.ajax({
        type: 'GET',
        dataType: 'json',
        data: {},
        url: "http://"+url+"/stations",
        error: function (jqXHR, textStatus, errorThrown) {
            console.log(jqXHR);
        },
        success: function (msg) {
          console.log(msg["id"]);
          console.log(msg["content"]);
        }
    });


      var stations = [                       
      { lat:45.75, lng:4.84, nb:"1" },                      
      { lat:45.77, lng:4.85, nb:"2"},                      
      { lat:45.768, lng:4.825, nb:"3" },                      
      { lat:45.759, lng:4.838, nb:"4" },                      
      { lat:45.771, lng:4.861, nb:"5" },                      
      { lat:45.762, lng:4.855, nb:"6" }      
      ];                             

      // POUR CHAQUE STATION ON AJOUTE UN MARQUER
      stations.forEach( function(station){ 

        var optionsMarqueur = {
          map: maCarte,
          position: new google.maps.LatLng( station.lat, station.lng ) ,
          label :station.nb
        };
        var marqueur = new google.maps.Marker( optionsMarqueur );

        // SUR CHAQUE MARQUE ON AJOUTE UN LISTENER QUI VA REPERER LE CLICK DESSUS ET AFFICHER LES DETAILS
        marqueur.addListener('click', function() {
          alert("SURPRISE !!!!" + marqueur.label);
        });
      });
    }


    // Fonction a améliorer et a décider (si pas de localisation on affiche quoi? centre de lyon, barycentre des stations,...)
    function fail(){
      var div=document.getElementById("map_canvas");
      div.innerHTML="Erreur lors du chargement de la localisation, nous ne pouvons acceder a votre demande. Veuillez authoriser la localisation"
    }


  </script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAd8uGJEdFvOjHRxtMNoHFl6u9hdVrNSWQ&callback=locate"></script>
  </html> 

